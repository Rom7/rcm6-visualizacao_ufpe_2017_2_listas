// VARIABLES GLOABLES

var donnees = new Array(2);
var w = 1200;
var h = 1080;
var inet = "localhost";

var svg = d3.select("body")
					.append("svg")
					.attr("width", w)
					.attr("height", h);




// ----- ICI COMMENCE LE CODE ----- //



d3.csv("http://"+inet+":8000/sida-stats.csv", function(error, data)
{
	if(error)
	{
		console.log(error)
	}
	else
	{
		svg.append("text").attr("x",200).attr("y",200)
								.text("Please wait...").style("font-size","30")
								.attr("id","msg");

		var opt = {}
		opt.epsilon = 10;
		opt.perplexity = 18;
		opt.dim = 2;

		var tsne = new tsnejs.tSNE(opt);

		var dists = 
		[
			[379,286,211,177,151,106,81,62,64,32,38,37,33,24,20,24],
			[139,159,167,100,84,91,30,33,28,34,18,29,27,25,22,26],
			[138,81,114,106,58,41,31,28,30,24,30,20,25,28,18,29],
			[281,240,299,399,372,343,263,235,199,139,68,46,61,57,43,29],
			[93,64,65,71,56,138,116,45,44,28,25,11,20,14,13,6],
			[581,444,524,553,517,304,220,163,157,124,104,59,61,53,67,64],
			[77,79,55,54,46,43,25,21,27,29,45,33,40,25,31,36],
			[253,210,256,169,162,180,73,71,139,62,49,57,24,36,28,28],
			[446,283,442,410,355,196,141,89,108,67,64,70,37,36,31,31],
			[340,243,305,341,312,230,163,89,78,40,50,28,25,26,11,18],
			[38,31,25,21,29,11,13,11,11,6,8,6,1,1,0,3],
			[14,11,22,16,21,4,12,4,1,4,1,1,3,3,2,2],
			[11,6,10,7,5,7,3,4,2,0,3,4,2,0,1,1],
			[66,61,49,35,30,27,39,22,32,27,12,8,10,10,10,9],
			[610,294,287,335,405,309,231,135,132,77,75,67,48,63,58,49],
			[930,618,560,597,632,496,409,289,265,217,214,175,140,100,109,77],
			[78,53,46,32,30,37,21,15,17,16,8,9,9,8,3,4],
			[74,45,44,21,35,34,10,20,13,5,10,13,4,7,7,3],
			[240,213,159,178,145,91,68,48,62,35,37,28,18,14,12,14],
			[23,26,21,15,20,17,6,7,7,7,5,2,5,1,2,0],
			[17,23,11,17,18,11,3,7,2,4,0,3,3,0,2,1],
			[21,12,5,5,10,7,5,5,4,1,4,2,1,2,3,1],
			[5,3,1,1,1,0,3,2,0,0,1,0,0,1,0,0],
			[5,5,4,6,3,6,0,8,2,0,0,0,1,0,0,1],
			[5,5,4,2,2,1,1,0,3,0,0,0,0,0,0,2],
			[6,4,3,6,2,1,3,1,1,2,3,0,3,1,0,0],
			[22,20,10,6,16,12,8,4,7,6,5,8,6,2,1,2],
			[16,3,6,12,9,6,4,8,11,11,6,6,6,1,3,1],
			[2,2,1,2,2,1,1,1,0,2,2,0,0,0,0,0],
			[33,20,4,9,4,8,2,5,3,2,4,2,1,3,1,0],
			[1,0,1,1,1,1,0,0,0,2,0,1,1,0,0,0],
			[2,0,2,1,1,0,1,0,0,0,0,0,1,1,0,0],
			[9,6,3,2,4,0,6,2,3,3,0,0,2,1,1,1],
			[89,58,55,62,69,43,48,19,31,17,23,19,13,14,8,11],
			[44,53,45,44,44,56,30,27,27,18,17,19,10,5,4,10],
			[167,116,86,94,103,72,67,63,43,43,47,41,33,33,30,28]
		];

		console.log(dists);
		//tsne.initDataDist(dists);
		tsne.initDataRaw(dists);

		for(var k = 0; k < 20000; k++)
		{
			tsne.step();
		}

		var Y = tsne.getSolution();

		//console.log(typeof(Y[3][2]));


		svg.select("#msg").remove();


		var circles = svg.selectAll("circle").data(dists).enter().append("circle")
						 .attr("cx", function(d,i) {
						 	return (Y[i][0]*90 + 400)
						})
						 .attr("cy", function(d,i) {
						 	return (Y[i][1]*90 + 400)
						})
						 .attr("r", 5)
						 .attr("stroke-width", 1)
						 .attr("stroke", "black")
						 .attr("fill", "orange")
						 .append("title")
						 .text(function(d,i)
						 	{
						 		return data[i].Regiao ;
						 	});
		//console.log(Y);

	}
})


